<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Globite - 每日一國</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; }
        body { font-family: sans-serif; background-color: var(--bg); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .card { background: white; width: 90%; max-width: 380px; border-radius: 28px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; text-align: center; }
        .image-container { width: 100%; height: 200px; background: #e2e8f0; }
        .image-container img { width: 100%; height: 100%; object-fit: contain; background: #eee; }
        .content { padding: 24px; }
        .tag { display: inline-block; background: #f1f5f9; padding: 5px 14px; border-radius: 50px; font-size: 13px; color: #64748b; margin-bottom: 12px; }
        h1 { margin: 5px 0; font-size: 26px; }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px 0; text-align: left; }
        .info-item { background: #f8fafc; padding: 10px; border-radius: 12px; }
        .label { color: #94a3b8; font-size: 11px; display: block; }
        .value { font-weight: 600; color: #334155; font-size: 14px; }
        .btn-group { display: flex; gap: 10px; }
        button { flex: 1.5; background: var(--primary); color: white; border: none; padding: 14px; border-radius: 14px; font-size: 16px; font-weight: 600; cursor: pointer; }
        button.secondary { flex: 1; background: #f1f5f9; color: #475569; }
        #status-msg { font-size: 12px; color: #ef4444; margin-top: 10px; }
    </style>
</head>
<body>

<div class="card">
    <div class="image-container">
        <img id="flagImg" src="" alt="請點擊換下一站">
    </div>
    <div class="content">
        <div id="region" class="tag">等待初始化...</div>
        <h1 id="countryName">載入中...</h1>
        
        <div class="info-grid">
            <div class="info-item">
                <span class="label">官方首都</span>
                <span id="capital" class="value">-</span>
            </div>
            <div class="info-item">
                <span class="label">人口數量</span>
                <span id="population" class="value">-</span>
            </div>
        </div>

        <div class="btn-group">
            <a id="wikiLink" href="#" target="_blank" style="flex:1">
                <button class="secondary">百科</button>
            </a>
            <button onclick="nextCountry()">下一站</button>
        </div>
        <div id="status-msg"></div>
    </div>
</div>

<script>
    let allCountries = [];

    // 強制從網路抓取，避免快取問題
    async function fetchCountries() {
        const status = document.getElementById('status-msg');
        try {
            status.innerText = "正在連線至衛星資料庫...";
            const response = await fetch('https://restcountries.com/v3.1/all?fields=name,translations,flags,continents,capital,population,maps');
            
            if (!response.ok) throw new Error(`HTTP 錯誤! 狀態: ${response.status}`);
            
            const data = await response.json();
            
            allCountries = data.map(c => ({
                commonName: c.translations?.zho?.common || c.name.common,
                flagUrl: c.flags.png, // 改用 PNG 增加相容性
                region: c.continents ? c.continents[0] : '未知',
                capital: c.capital ? c.capital[0] : '無',
                population: c.population ? c.population.toLocaleString() : '不詳',
                wikiUrl: `https://zh.wikipedia.org/wiki/${c.translations?.zho?.common || c.name.common}`
            }));
            
            status.innerText = ""; // 清除錯誤訊息
            nextCountry();
        } catch (error) {
            console.error(error);
            status.innerText = "連線失敗：" + error.message + "。請重新整理頁面。";
            document.getElementById('countryName').innerText = "連線中斷";
        }
    }

    function nextCountry() {
        if (allCountries.length === 0) {
            fetchCountries();
            return;
        }

        const c = allCountries[Math.floor(Math.random() * allCountries.length)];
        
        document.getElementById('flagImg').src = c.flagUrl;
        document.getElementById('region').innerText = c.region;
        document.getElementById('countryName').innerText = c.commonName;
        document.getElementById('capital').innerText = c.capital;
        document.getElementById('population').innerText = c.population;
        document.getElementById('wikiLink').href = c.wikiUrl;
    }

    // 啟動
    fetchCountries();
</script>

</body>
</html>